---

- name: Download Flannel
  get_url:
    url: https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
    dest: /home/pi/.kube/
    mode: '0777'
    owner: pi
    group: pi
  when: port8080up
  register: flannel_downloaded







- name: Install kubernetes dashboard
  shell: kubectl apply -f files/kubernetes-dashboard.yml

- name: Configure dashboard access
  shell: kubectl apply -f files/dashboard-admin.yml

- name: Force rebuild dashboard pods
  shell: kubectl -n kube-system delete $(kubectl -n kube-system get pod -o name | grep dashboard)

- name: Fetch kubeconfig files
  fetch:
    src: /root/.kube/config
    dest: ~/.kube/config
    flat: yes
